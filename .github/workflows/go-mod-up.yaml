---
name: Update Dependencies
on:
  schedule:
    - cron: '0 8 * * 1'
  workflow_dispatch:

jobs:
  update-dep:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Setup Go
        uses: actions/setup-go@v3
        with:
          go-version: 1.18.3
      - name: Update dependencies
        run: |
          make go-mod-update
          make generate
      - name: Run Tests
        run: make lint test
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v4
        with:
          commit-message: Update go module dependencies
          title: Update go module dependencies
          author: GitHub Bot <noreply@github.com>
          committer: GitHub Bot <noreply@github.com>
          body: |
            - Dependency updates
            Auto-generated by https://github.com/nitrictech/cli/tree/develop/.github/workflows/go-mod-up.yaml

          branch: update-dependencies
